<mat-progress-bar mode="indeterminate" *ngIf="isLoading"></mat-progress-bar>

<div class="flex flex-col items-center">
  <ul class="flex items-left w-5/6" *ngFor="let task of mainTasksToDisplay">
    <li
      class="
        w-full
        rounded
        bg-black bg-opacity-80
        text-gray-300
        h-8
        break-all
        mb-2
        flex
        justify-between
      "
    >
      <div class="flex items-center">
        <mat-icon
          class="text-white mr-2 ml-1 cursor-pointer hover:text-blue-500"
          (click)="completeTask(task.id, task.completed)"
          >{{
            task.completed ? "check_circle" : "check_circle_outline"
          }}</mat-icon
        >
        <span *ngIf="task.completed === true; else notCompleted">
          <s>{{ task.todo }}</s>
        </span>
        <ng-template #notCompleted
          ><span>{{ task.todo }}</span></ng-template
        >
      </div>
      <div class="flex items-center">
        <button mat-button [matMenuTriggerFor]="menu">
          <mat-icon
            class="text-white mr-2 ml-1 cursor-pointer hover:text-blue-500"
            >more_vert</mat-icon
          >
        </button>
        <mat-menu #menu="matMenu" class="text-gray-300 bg-gray-800">
          <div class="text-sm flex flex-col px-2">
            <button
              class="
                hover:bg-gray-700
                border-l-2 border-transparent
                hover:border-gray-500
                flex
                items-center
              "
            >
              <mat-icon class="text-gray-300 text-sm">star_border</mat-icon
              ><span>Mark as important</span>
            </button>
            <button
              class="
                hover:bg-gray-700
                border-l-2 border-transparent
                hover:border-gray-500
              "
              (click)="completeTask(task.id, task.completed)"
            >
              <mat-icon class="text-gray-300 text-sm">{{
                task.completed ? "check_circle" : "check_circle_outline"
              }}</mat-icon>
              <span>{{
                task.completed ? "Mark as not completed" : "Mark as completed"
              }}</span>
            </button>
            <div class="h-2 w-full border-b-2 border-gray-500 mx-auto"></div>
            <button
              class="
                hover:bg-gray-700
                border-l-2 border-transparent
                hover:border-gray-500
                text-left
                flex
                items-center
              "
            >
              <mat-icon class="text-gray-300 text-sm">today</mat-icon>
              <span>Due today</span>
            </button>
            <button
              class="
                hover:bg-gray-700
                border-l-2 border-transparent
                hover:border-gray-500
                text-left
                flex
                items-center
              "
            >
              <mat-icon class="text-gray-300 text-sm">event</mat-icon>
              <span>Due tomorrow</span>
            </button>
            <div class="h-2 w-full border-b-2 border-gray-500 mx-auto"></div>
            <button
              class="
                hover:bg-gray-700
                border-l-2 border-transparent
                hover:border-gray-500
                text-left
                flex
                items-center
              "
              (click)="deleteTask(task.id)"
            >
              <mat-icon class="text-gray-300 text-sm">delete_outline</mat-icon>
              <span>Delete</span>
            </button>
          </div>
        </mat-menu>
      </div>
    </li>
  </ul>
</div>

<div class="absolute bottom-8 w-full">
  <form
    [formGroup]="mainTaskForm"
    class="flex justify-center"
    (ngSubmit)="submitMainTaskForm(mainTaskForm)"
  >
    <div class="flex flex-col items-left w-5/6">
      <input
        type="text"
        formControlName="task"
        class="w-full rounded bg-black bg-opacity-80 text-gray-300"
        placeholder="+ Add a task"
      />
      <div class="w-ft h-4">
        <span
          class="text-red-900 bg-black bg-opacity-80 w-ft h-4 px-2"
          *ngIf="
            getTaskControl.task.errors?.required &&
            (getTaskControl.task.touched || getTaskControl.task.dirty)
          "
          >A value must be provided</span
        >
        <span
          class="text-red-900 bg-black bg-opacity-80 w-ft h-4 px-2"
          *ngIf="
            getTaskControl.task.errors?.minlength &&
            (getTaskControl.task.touched || getTaskControl.task.dirty)
          "
          >Task must have more than one character</span
        >
      </div>
    </div>
  </form>
</div>
